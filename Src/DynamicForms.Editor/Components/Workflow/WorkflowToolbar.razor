@*
    WorkflowToolbar - Main toolbar for workflow editor

    Features:
    - Save and publish actions
    - Undo/redo functionality
    - Import/export workflows
    - Visual feedback for dirty state and action availability
*@

<div class="workflow-toolbar">
    <!-- Left Section: Primary Actions -->
    <div class="toolbar-section toolbar-primary">
        <!-- Save Button -->
        <button type="button"
                class="btn btn-primary toolbar-btn"
                @onclick="HandleSave"
                disabled="@(!IsDirty)"
                title="@(IsDirty ? "Save changes" : "No changes to save")">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
            </svg>
            <span class="toolbar-text">Save</span>
            @if (IsDirty)
            {
                <span class="badge bg-warning ms-1">*</span>
            }
        </button>

        <!-- Publish Button -->
        <button type="button"
                class="btn btn-success toolbar-btn"
                @onclick="HandlePublish"
                title="Publish workflow">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M10.854 8.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5z"/>
            </svg>
            <span class="toolbar-text">Publish</span>
        </button>
    </div>

    <!-- Middle Section: History Actions -->
    <div class="toolbar-section toolbar-history">
        <!-- Undo Button -->
        <button type="button"
                class="btn btn-outline-secondary toolbar-btn"
                @onclick="HandleUndo"
                disabled="@(!CanUndo)"
                title="@(CanUndo ? "Undo last change" : "Nothing to undo")">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
            </svg>
            <span class="toolbar-text">Undo</span>
        </button>

        <!-- Redo Button -->
        <button type="button"
                class="btn btn-outline-secondary toolbar-btn"
                @onclick="HandleRedo"
                disabled="@(!CanRedo)"
                title="@(CanRedo ? "Redo last undone change" : "Nothing to redo")">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
            </svg>
            <span class="toolbar-text">Redo</span>
        </button>
    </div>

    <!-- Right Section: Import/Export -->
    <div class="toolbar-section toolbar-import-export">
        <!-- Import Button -->
        <button type="button"
                class="btn btn-outline-primary toolbar-btn"
                @onclick="HandleImport"
                title="Import workflow from JSON">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
            </svg>
            <span class="toolbar-text">Import</span>
        </button>

        <!-- Export Button -->
        <button type="button"
                class="btn btn-outline-primary toolbar-btn"
                @onclick="HandleExport"
                title="Export workflow to JSON">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
            </svg>
            <span class="toolbar-text">Export</span>
        </button>
    </div>
</div>

@code {
    // ========================================================================
    // PARAMETERS
    // ========================================================================

    /// <summary>
    /// Indicates whether undo is available
    /// </summary>
    [Parameter]
    public bool CanUndo { get; set; }

    /// <summary>
    /// Indicates whether redo is available
    /// </summary>
    [Parameter]
    public bool CanRedo { get; set; }

    /// <summary>
    /// Indicates whether there are unsaved changes
    /// </summary>
    [Parameter]
    public bool IsDirty { get; set; }

    /// <summary>
    /// Event fired when save is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnSave { get; set; }

    /// <summary>
    /// Event fired when publish is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnPublish { get; set; }

    /// <summary>
    /// Event fired when undo is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnUndo { get; set; }

    /// <summary>
    /// Event fired when redo is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnRedo { get; set; }

    /// <summary>
    /// Event fired when import is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnImport { get; set; }

    /// <summary>
    /// Event fired when export is clicked
    /// </summary>
    [Parameter]
    public EventCallback OnExport { get; set; }

    // ========================================================================
    // EVENT HANDLERS
    // ========================================================================

    private async Task HandleSave()
    {
        await OnSave.InvokeAsync();
    }

    private async Task HandlePublish()
    {
        await OnPublish.InvokeAsync();
    }

    private async Task HandleUndo()
    {
        await OnUndo.InvokeAsync();
    }

    private async Task HandleRedo()
    {
        await OnRedo.InvokeAsync();
    }

    private async Task HandleImport()
    {
        await OnImport.InvokeAsync();
    }

    private async Task HandleExport()
    {
        await OnExport.InvokeAsync();
    }
}
